<div class="form-wrapper">
  <div class="form-inner-wrapper">
    <form id="centerline-form" autocomplete="on" novalidate="">
      <div class="field-list clear">
        <div class="form-item field text required">

          <label class="title" for="text-3ac2e08c-5f1c-4684-ac86-58935b8b0793-field">
            Name
            <span class="required" aria-hidden="true">*</span>
          </label>
          <input class="field-element text" type="text" id="text-3ac2e08c-5f1c-4684-ac86-58935b8b0793-field"
            aria-required="true">
        </div>

        <div id="email-yui_3_17_2_1_1553888888520_3745" class="form-item field email required">
          <label class="title" for="email-yui_3_17_2_1_1553888888520_3745-field">
            Email
            <span class="required" aria-hidden="true">*</span>
          </label>
          <input class="field-element" id="email-yui_3_17_2_1_1553888888520_3745-field" name="email" type="email"
            autocomplete="email" spellcheck="false" aria-required="true">
        </div>

        <fieldset class="form-item fields">
          <label class="title" for="phone">
            Phone
          </label>
          <div class="field text">
            <label class="caption">
              <input id="phone" class="field-element phone" type="tel" type="phone">
              <!-- <span class="caption-text">(###)</span> -->
            </label>
          </div>
        </fieldset>

        <div id="select-6943e413-fdfe-4370-97e8-081daac9877b" class="form-item field select required">

          <label class="title" for="select-6943e413-fdfe-4370-97e8-081daac9877b-field">
            Reason
            <span class="required" aria-hidden="true">*</span>
          </label>
          <select id="select-6943e413-fdfe-4370-97e8-081daac9877b-field"
            name="select-6943e413-fdfe-4370-97e8-081daac9877b-field" aria-required="true">
            <optgroup label="Select a Spindle..">
            <option value="Sycotec">Sycotec</option>
            <option value="Henninger">Henninger</option>
            <option value="Orlieb">Orlieb</option>
            <option value="Alfred Jaeger">Alfred Jaeger</option>
            <option value="Renaud">Renaud</option>
            <option value="Other">Other</option>
            </optgroup>
          </select>
        </div>

        <div id="textarea-yui_3_17_2_1_1553888888520_3747" class="form-item field textarea required">
          <label class="title" for="textarea-yui_3_17_2_1_1553888888520_3747-field">
            Message
            <span class="required" aria-hidden="true">*</span>
          </label>
          <textarea class="field-element"id="textarea-yui_3_17_2_1_1553888888520_3747-field"
            aria-required="true"></textarea>
        </div>
        <div class="box__input">
          <label class="title">
            File Upload
            <span class="required" aria-hidden="true">*</span>
          </label>
          <input class="box__file" type="file" name="files[]" id="file" data-multiple-caption="{count} files selected"
          multiple />
          <label for="file"><strong>Choose a file</strong><span class="box__dragndrop"> or drag it here</span>.</label>
          <button class="box__button" type="submit">Upload</button>
          </div>
          <div class="box__uploading">Uploadingâ€¦</div>
          <div class="box__success">Done!</div>
          <div class="box__error">Error! <span></span>.</div>
      </div>

      <div data-animation-role="button" class="form-button-wrapper

        form-button-wrapper--align-left">
        <input class="button sqs-system-button sqs-editable-button sqs-button-element--primary" type="submit"
          value="Submit">
      </div>

      <div class="hidden form-submission-text">
        <p class="" style="white-space:pre-wrap;">Thank you!</p>
      </div>
      <div class="hidden form-submission-html" data-submission-html=""></div>
    </form>
    <script>
        var telInput = document.querySelector("#phone");
        var iti = window.intlTelInput(telInput, {
          // any initialisation options go here
          utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.16/js/utils.min.js",
          preferredCountries: ['US'],
          nationalMode: false,
          formatOnDisplay: true // SET THIS!!!
        });

        telInput.addEventListener('keyup', formatIntlTelInput);
        telInput.addEventListener('change', formatIntlTelInput);

        function formatIntlTelInput() {
          if (typeof intlTelInputUtils !== 'undefined') { // utils are lazy loaded, so must check
            var currentText = iti.getNumber(intlTelInputUtils.numberFormat.E164);
            if (typeof currentText === 'string') { // sometimes the currentText is an object :)
              iti.setNumber(currentText); // will autoformat because of formatOnDisplay=true
            }
          }
        }

        /** File Upload **/

        /** Submit to AWS **/
        (() => {
          const form = document.querySelector('#centerline-form');
          const submitResponse = document.querySelector('#response');
          const formURL = 'https://8c4b8geecl.execute-api.us-west-1.amazonaws.com/Prod/submitForm';

          form.onsubmit = e => {
            e.preventDefault();

            // Capture the form data
            let data = {};
            Array.from(form).map(input => (data[input.id] = input.value));
            console.log('Sending: ', JSON.stringify(data));
            submitResponse.innerHTML = 'Sending...'

            // Create the AJAX request
            var xhr = new XMLHttpRequest();
            xhr.open(form.method, formURL, true);
            xhr.setRequestHeader('Accept', 'application/json; charset=utf-8');
            xhr.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');

            // Send the collected data as JSON
            xhr.send(JSON.stringify(data));

            xhr.onloadend = response => {
              if (response.target.status === 200) {
                form.reset();
                submitResponse.innerHTML = 'Form submitted. Success!';
              } else {
                submitResponse.innerHTML = 'Error! Please try again.';
                console.error(JSON.parse(response));
              }
            };
          };
        })();
    </script>
  </div>
</div>